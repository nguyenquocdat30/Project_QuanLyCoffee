CREATE DATABASE QUANLYCOFFEE
ON PRIMARY
(
	NAME = QUANLYCOFFEE,
	FILENAME = 'E:\PROJECT_SQL\QUANLYCOFFEE\QUANLYCOFFEE.MDF',
	SIZE = 10MB,
	MAXSIZE = 20MB,
	FILEGROWTH = 5MB
)
LOG ON
(
	NAME = LOGQUANLYCOFFEE,
	FILENAME = 'E:\PROJECT_SQL\QUANLYCOFFEE\QUANLYCOFFEE.LDF',
	SIZE = 10MB,
	MAXSIZE = 20MB,
	FILEGROWTH = 5MB
)
GO
USE QUANLYCOFFEE
GO

--===============================CREATE TABLE ==========================================
CREATE TABLE TAIKHOAN
(
	USERNAME VARCHAR(20) NOT NULL PRIMARY KEY,
	PASSWORD VARCHAR(100) NOT NULL,
	QUYENHAN BIT NOT NULL DEFAULT 0 -- 0 : USER . 1:ADMIN
)
GO
CREATE TABLE NHANVIEN
(
	USERNAME VARCHAR(20) NOT NULL PRIMARY KEY,
	MANV VARCHAR(5) NOT NULL UNIQUE,
	HONV NVARCHAR(30) NOT NULL,
	TENNV NVARCHAR(10) NOT NULL,
	NGAYSINH DATE NOT NULL,
	GIOITINH BIT NOT NULL DEFAULT 0, -- 0 :NU . 1:NAM
	DIENTHOAI VARCHAR(12) NOT NULL,
	CMND VARCHAR(12) NOT NULL,
	NGAYVAOLAM DATE NOT NULL,
	CONSTRAINT NHANVIEN_TAIKHOAN FOREIGN KEY (USERNAME) REFERENCES dbo.TAIKHOAN(USERNAME)
)
GO
CREATE TABLE NHACUNGCAP
(
	MANCC VARCHAR(5) NOT NULL PRIMARY KEY,
	TENNCC NVARCHAR(40) NOT NULL,
	DIENTHOAI VARCHAR(12) NOT NULL
)
GO
CREATE TABLE NHASANXUAT
(
	MANSX VARCHAR(5) NOT NULL PRIMARY KEY,
	TENNSX NVARCHAR(40) NOT NULL,
	QUOCGIA NVARCHAR(30) NOT NULL
)
GO
CREATE TABLE SANPHAM
(
	MASP VARCHAR(5) NOT NULL PRIMARY KEY,
	TENSP NVARCHAR(40) NOT NULL,
	SOLUONGTONKHO INT NOT NULL CHECK(SOLUONGTONKHO >=0),
	NGAYSX DATE NOT NULL CHECK(DATEDIFF(DAY,NGAYSX,GETDATE())>0),
	HANSUDUNG DATE NOT NULL,
	DONGIA INT NOT NULL CHECK(DONGIA>=0),
	MOTA NVARCHAR(100) NOT NULL,
	MANSX VARCHAR(5) NOT NULL FOREIGN KEY REFERENCES dbo.NHASANXUAT(MANSX) ON UPDATE CASCADE ON DELETE CASCADE,
	MANCC VARCHAR(5) NOT NULL FOREIGN KEY REFERENCES dbo.NHACUNGCAP(MANCC) ON UPDATE CASCADE ON DELETE CASCADE
)
GO
CREATE TABLE BAN
(
	MABAN VARCHAR(5) NOT NULL PRIMARY KEY,
	TRANGTHAI BIT NOT NULL DEFAULT 0 -- 0 : RỖNG . 1: CÓ NGƯỜI
)
GO
CREATE TABLE HOADON
(
	MAHD VARCHAR(5) NOT NULL PRIMARY KEY,
	NGAYLAPHD DATE DEFAULT GETDATE(),
	TRANGTHAI BIT NOT NULL DEFAULT 0, -- 0 : CHƯA THANH TOÁN  . 1: ĐÃ THANH TOÁN
	USERNAME VARCHAR(20) NOT NULL FOREIGN KEY REFERENCES dbo.NHANVIEN(USERNAME) ON UPDATE CASCADE ON DELETE CASCADE,
	MABAN VARCHAR(5) NOT NULL FOREIGN KEY REFERENCES dbo.BAN(MABAN) ON UPDATE CASCADE ON DELETE CASCADE
)
GO
CREATE TABLE CTHD
(
	MAHD VARCHAR(5) NOT NULL FOREIGN KEY REFERENCES dbo.HOADON(MAHD) ON UPDATE CASCADE ON DELETE CASCADE,
	MASP VARCHAR(5) NOT NULL FOREIGN KEY REFERENCES dbo.SANPHAM(MASP) ON UPDATE CASCADE ON DELETE CASCADE,
	SOLUONG INT NOT NULL CHECK (SOLUONG >0),
	CONSTRAINT PRIMARY_KEY_CTHD PRIMARY KEY(MAHD,MASP)
)
GO
--==============================================================================================================
-- PROCEDURE UPDATE TRẠNG THÁI BÀN
CREATE PROCEDURE UPDATE_TRANGTHAI_BAN
@MABAN VARCHAR(5),
@TRANGTHAI BIT 
AS
BEGIN
	UPDATE dbo.BAN SET TRANGTHAI = @TRANGTHAI WHERE MABAN = @MABAN
END
GO
-- PROCEDURE LOAD DANH SACH BAN
CREATE PROCEDURE LOAD_DANHSACH_BAN
AS
BEGIN
	SELECT * FROM BAN
END
GO
-- PROCEDURE DELETE BAN
CREATE PROCEDURE DELETE_BAN
@MABAN VARCHAR(5)
AS
BEGIN
	DELETE FROM dbo.BAN WHERE MABAN = @MABAN
END
GO

-- PROCEDURE INSERT BAN
CREATE PROCEDURE INSERT_BAN
@MABAN VARCHAR(5),
@TRANGTHAI BIT
AS
BEGIN
	INSERT INTO dbo.BAN( MABAN, TRANGTHAI ) VALUES  (@MABAN,@TRANGTHAI)
END
GO
 -- PROCEDURE LOAD TRANG THAI BY MABAN
 CREATE PROCEDURE LOAD_TRANGTHAI_BY_MABAN
 @MABAN VARCHAR(5)
 AS
 BEGIN
	SELECT * FROM BAN WHERE MABAN = @MABAN
 END
 GO
 
 --========================================================================================
 -- PROCEDURE LOAD CTHD THEO MASP VA MA HD
 CREATE PROCEDURE LOAD_CTHD_BYMASP_MAHD
 @MASP VARCHAR(5),
 @MAHD VARCHAR(5)
 AS
 BEGIN
	 SELECT * FROM CTHD WHERE MASP = @MASP AND MAHD=@MAHD
 END
 GO
 -- PROCEDURE LOAD CTHD
 CREATE PROCEDURE LOAD_CTHD
 AS
 BEGIN
	SELECT * FROM CTHD
 END
 GO
 -- UPDATE SO LUONG  CTHD BY MASP VA MAHD
 CREATE PROCEDURE UPDATE_SOLUONG_MASP_MAHD
 @MAHD VARCHAR(5),
 @MASP VARCHAR(5),
 @SOLUONG INT 
 AS
 BEGIN
	UPDATE dbo.CTHD SET SOLUONG = @SOLUONG WHERE MAHD = @MAHD AND MASP = @MASP
 END
 GO
 -- KIEM TRA SAN PHAM TRONG CTHD BY MAHD VA MASP
 CREATE PROCEDURE KIEMTRASANPHAM_CTHD_MAHD_MASP
 @MAHD VARCHAR(5),
 @MASP VARCHAR(5)
 AS
 BEGIN
	SELECT * FROM dbo.CTHD WHERE MAHD = @MAHD AND MASP = @MASP
 END
 GO
 -- LOAD CTHD BY MAHD
 CREATE PROCEDURE LOAD_CTHD_MAHD
 @MAHD VARCHAR(5)
 AS
 BEGIN
	SELECT * FROM dbo.CTHD WHERE MAHD = @MAHD
 END
 GO
 -- THEM CTHD
 CREATE PROCEDURE INSERT_CTHD
 @MAHD VARCHAR(5),
 @MASP VARCHAR(5),
 @SOLUONG INT
 AS
 BEGIN
	INSERT INTO dbo.CTHD( MAHD, MASP, SOLUONG )VALUES  ( @MAHD,@MASP,@SOLUONG)
 END
 GO
 -- DELETE CTHD
 CREATE PROCEDURE DELETE_CTHD
 @MAHD VARCHAR(5),
 @MASP VARCHAR(5)
 AS
 BEGIN
	DELETE FROM dbo.CTHD WHERE MAHD =@MAHD AND MASP =@MASP
 END
 GO
--==================================================================================================================
-- HOA DON
-- LAY HOA DON CHUA THANH TOAN THONG QUA MABAN
CREATE PROCEDURE GET_HOADON_CHUATHANHTOAN_BYMABAN
@MABAN VARCHAR(5)
AS
BEGIN
	SELECT MAHD,CONVERT(VARCHAR(10),NGAYLAPHD)AS NGAYLAPHD,TRANGTHAI,USERNAME,MABAN FROM dbo.HOADON WHERE MABAN = @MABAN AND TRANGTHAI = 0
END
GO
-- UPDATE HOA DON KHI THANH TOAN
CREATE PROCEDURE UPDATE_HOADON_THANHTOAN
@MAHD VARCHAR(5)
AS
BEGIN
	UPDATE dbo.HOADON SET TRANGTHAI = 1 WHERE MAHD = @MAHD
END
GO
 -- LOAD DANH SACH HOA DON
 CREATE PROCEDURE LOAD_DANHSACH_HOADON
 AS
 BEGIN
	SELECT MAHD,CONVERT(VARCHAR(10),NGAYLAPHD)AS NGAYLAPHD,TRANGTHAI,USERNAME,MABAN FROM dbo.HOADON
 END
 GO
 -- UPDATE HOA DON
 CREATE PROCEDURE UPDATE_HOADON
 @MAHD VARCHAR(5),
 @NGAYLAPHD DATE,
 @TRANGTHAI BIT,
 @USERNAME VARCHAR(20),
 @MABAN VARCHAR(5)
 AS
 BEGIN
	UPDATE dbo.HOADON SET NGAYLAPHD = @NGAYLAPHD,TRANGTHAI = @TRANGTHAI,USERNAME = @USERNAME,MABAN = @MABAN WHERE MAHD = @MAHD
 END
 GO
 -- DELETE HOA DON
 CREATE PROCEDURE DELETE_HOADON
 @MAHD VARCHAR(5)
 AS
 BEGIN
	DELETE FROM dbo.HOADON WHERE MAHD =@MAHD
 END
 GO
 -- INSERT HOA DON TU SINH MA
 CREATE PROCEDURE INSERT_HOADON_TUSINHMA
 @NGAYLAPHD DATE,
 @TRANGTHAI BIT,
 @USERNAME VARCHAR(20),
 @MABAN VARCHAR(5)
 AS
 BEGIN
 DECLARE @MA_NEXT VARCHAR(5)
	SELECT @MA_NEXT = dbo.HOADON.MAHD FROM dbo.HOADON
	IF @MA_NEXT IS NULL
		SET @MA_NEXT = 0
	ELSE
		SELECT @MA_NEXT = CONVERT(INT,SUBSTRING(MAX(dbo.HOADON.MAHD),3,3)) FROM dbo.HOADON
	SELECT @MA_NEXT = 
	CASE
		WHEN @MA_NEXT >= 0 AND @MA_NEXT <9 THEN 'HD00'+CONVERT(VARCHAR(1),@MA_NEXT+1)
		WHEN @MA_NEXT >=9 AND @MA_NEXT <99 THEN 'HD0'+CONVERT(VARCHAR(2),@MA_NEXT+1)
		WHEN @MA_NEXT >= 99 AND @MA_NEXT <999 THEN 'HD'+CONVERT(VARCHAR(3),@MA_NEXT+1)
	END
	INSERT INTO dbo.HOADON( MAHD , NGAYLAPHD ,TRANGTHAI ,USERNAME ,MABAN)VALUES  ( @MA_NEXT ,@NGAYLAPHD ,@TRANGTHAI , @USERNAME , @MABAN)
 END
GO
--====================================================================================================================
-- BANG TAI KHOAN
-- LOAD TAI KHOAN
CREATE PROCEDURE LOAD_DANHSACH_TAIKHOAN
AS
BEGIN
	SELECT * FROM dbo.TAIKHOAN
END
GO
-- UPDATE TAI KHOAN
CREATE PROC UPDATE_TAIKHOAN
@USERNAME VARCHAR(20),
@PASSWORD VARCHAR(100),
@QUYENHAN BIT
AS
BEGIN
	UPDATE dbo.TAIKHOAN
	SET PASSWORD = @PASSWORD, QUYENHAN = @QUYENHAN
	WHERE USERNAME = @USERNAME AND PASSWORD = @PASSWORD
END
GO
-- DELETE TAI KHOAN
CREATE PROC DELETE_TAIKHOAN
@USERNAME VARCHAR(20)
AS
BEGIN
	DELETE FROM dbo.TAIKHOAN WHERE USERNAME = @USERNAME
END
GO
-- INSERT TAI KHOAN
CREATE PROC INSERT_TAIKHOAN
@USERNAME VARCHAR(20),
@PASSWORD VARCHAR(100),
@QUYENHAN BIT
AS
BEGIN
	INSERT INTO dbo.TAIKHOAN
	        ( USERNAME, PASSWORD, QUYENHAN )
	VALUES  ( @USERNAME, @PASSWORD, @QUYENHAN )
END
GO
-- CHECK LOGIN TAIKHOAN
CREATE PROCEDURE CHECK_LOGIN_TAIKHOAN
@USERNAME VARCHAR(20),
@PASSWORD VARCHAR(100)
AS
BEGIN
	SELECT * FROM TAIKHOAN WHERE USERNAME = @USERNAME AND PASSWORD = @PASSWORD
END
GO
-- LAY TAI KHOAN THONG QUA USERNAME
CREATE PROCEDURE THONGTIN_TAIKHOAN_BYUSERNAME
@USERNAME VARCHAR(20)
AS
BEGIN
	SELECT * FROM TAIKHOAN WHERE USERNAME = @USERNAME
END
GO
-- THAY DOI MAT KHAU 
CREATE PROCEDURE THAYDOI_MATKHAU_BYUSERNAME
@USERNAME VARCHAR(20),
@PASSWORD VARCHAR(100),
@NEWPASSWORD VARCHAR(100)
AS
BEGIN
	UPDATE dbo.TAIKHOAN
	SET PASSWORD = @NEWPASSWORD
	WHERE USERNAME = @USERNAME AND PASSWORD = @PASSWORD
END
GO
--=============================================== NSX ========================================================
-- LOAD NHASANXUAT
CREATE PROCEDURE LOAD_DANHSACH_NSX
AS
BEGIN
	SELECT * FROM dbo.NHASANXUAT
END
GO
-- INSERT NHASANXUAT
CREATE PROCEDURE INSERT_NHASANXUAT
@MANSX VARCHAR(5),
@TENNSX NVARCHAR(40),
@QUOCGIA NVARCHAR(30)
AS
BEGIN
	INSERT INTO dbo.NHASANXUAT
	        ( MANSX, TENNSX, QUOCGIA )
	VALUES  ( @MANSX, @TENNSX, @QUOCGIA )
END
GO
-- UPDATE NHASANXUAT
CREATE PROC UPDATE_NHASANXUAT
@MANSX VARCHAR(5),
@TENNSX NVARCHAR(40),
@QUOCGIA NVARCHAR(30)
AS
BEGIN
	UPDATE dbo.NHASANXUAT
	SET TENNSX = @TENNSX, QUOCGIA = @QUOCGIA
	WHERE MANSX=@MANSX
END
GO
-- DELETE NHASANXUAT
CREATE PROCEDURE DELETE_NHASANXUAT
@MANSX VARCHAR(5)
AS
BEGIN
	DELETE FROM dbo.NHASANXUAT
	WHERE MANSX = @MANSX
END
GO
--===============================================

-- LOAD NHA CUNG CAP
CREATE PROCEDURE LOAD_DANHSACH_NCC
AS
BEGIN
	SELECT * FROM dbo.NHACUNGCAP
END
GO
-- INSERT NHACUNGCAP
CREATE PROCEDURE INSERT_NHACUNGCAP
@MANCC VARCHAR(5),
@TENNCC NVARCHAR(40),
@DIENTHOAI VARCHAR(12)
AS
BEGIN
	INSERT INTO dbo.NHACUNGCAP
	        ( MANCC, TENNCC, DIENTHOAI )
	VALUES  ( @MANCC, @TENNCC, @DIENTHOAI )
END
GO
-- UPDATE NHACUNGCAP
CREATE PROC UPDATE_NHACUNGCAP
@MANCC VARCHAR(5),
@TENNCC NVARCHAR(40),
@DIENTHOAI VARCHAR(12)
AS
BEGIN
	UPDATE dbo.NHACUNGCAP
	SET TENNCC = @TENNCC, DIENTHOAI = @DIENTHOAI
	WHERE MANCC=@MANCC
END
GO
-- DELETE NHACUNGCAP
CREATE PROC DELETE_NHACUNGCAP
@MANCC VARCHAR(5)
AS
BEGIN
	DELETE FROM dbo.NHACUNGCAP 
	WHERE MANCC=@MANCC
END
GO
--=========================================================================
-- INSERT NHAN VIEN
CREATE PROC INSERT_NHANVIEN
@USERNAME VARCHAR(20),
@MANV VARCHAR(5),
@HONV NVARCHAR(30),
@TENNV NVARCHAR(10), 
@NGAYSINH DATE,
@GIOITINH BIT, -- 0 :NU . 1:NAM
@DIENTHOAI VARCHAR(12),
@CMND VARCHAR(12),
@NGAYVAOLAM DATE
AS
BEGIN
	INSERT INTO dbo.NHANVIEN
	        ( USERNAME ,
	          MANV ,
	          HONV ,
	          TENNV ,
	          NGAYSINH ,
	          GIOITINH ,
	          DIENTHOAI ,
	          CMND ,
	          NGAYVAOLAM
	        )
	 VALUES(@USERNAME,@MANV,@HONV,@TENNV,@NGAYSINH,@GIOITINH,@DIENTHOAI,@CMND,@NGAYVAOLAM)
END
GO
-- UPDATE NHAN VIEN
CREATE PROC UPDATE_NHANVIEN
@USERNAME VARCHAR(20),
@MANV VARCHAR(5),
@HONV NVARCHAR(30),
@TENNV NVARCHAR(10),
@NGAYSINH DATE,
@GIOITINH BIT,
@DIENTHOAI VARCHAR(12),
@CMND VARCHAR(12),
@NGAYVAOLAM DATE
AS
BEGIN
	UPDATE dbo.NHANVIEN
	SET MANV = @MANV, HONV = @HONV, TENNV = @TENNV, NGAYSINH = @NGAYSINH, GIOITINH = @GIOITINH, DIENTHOAI = @DIENTHOAI, CMND = @CMND, NGAYVAOLAM = @NGAYVAOLAM
	WHERE USERNAME = @USERNAME
END
GO
-- DELETE NHAN VIEN
CREATE PROC DELETE_NHANVIEN
@USERNAME VARCHAR(20)
AS
BEGIN
	DELETE FROM dbo.NHANVIEN
	WHERE USERNAME = @USERNAME
END
GO
-- LOAD NHAN VIEN
CREATE PROCEDURE LOAD_DANHSACH_NHANVIEN
AS
BEGIN
	SELECT * FROM dbo.NHANVIEN
END
GO

-- LOAD NHAN VIEN BY USERNAME
CREATE PROCEDURE LOAD_NHANVIEN_BYUSERNAME
@USERNAME VARCHAR(20)
AS
BEGIN
	SELECT USERNAME,MANV,HONV,TENNV,CONVERT(VARCHAR(10),NGAYSINH)AS NGAYSINH,GIOITINH,DIENTHOAI,CMND,CONVERT(VARCHAR(10),NGAYVAOLAM) AS NGAYVAOLAM FROM dbo.NHANVIEN WHERE USERNAME = @USERNAME
END
GO

--=======================================================================
-- LOAD SANPHAM
CREATE PROCEDURE LOAD_DANHSACH_SANPHAM
AS
BEGIN
	SELECT * FROM dbo.SANPHAM
END
GO
-- DELETE SAN PHAM
CREATE PROC DELETE_SANPHAN
 @MASP VARCHAR(5)
 AS
 BEGIN
 	DELETE FROM dbo.SANPHAM WHERE MASP = @MASP
 END
 GO
 -- UPDATE SANPHAM
 CREATE PROC UPDATE_SANPHAM
 @MASP VARCHAR(5),
 @TENSP NVARCHAR(40),
 @SOLUONGTONKHO INT,
 @NGAYSX DATE,
 @HANSUDUNG DATE,
 @DONGIA INT,
 @MOTA NVARCHAR(100),
 @MANSX VARCHAR(5),
 @MANCC VARCHAR(5)
 AS
 BEGIN
 	UPDATE dbo.SANPHAM
	SET TENSP = @TENSP, SOLUONGTONKHO = @SOLUONGTONKHO, NGAYSX = @NGAYSX, HANSUDUNG = @HANSUDUNG, DONGIA = @DONGIA, MOTA = @MOTA, MANSX = @MANSX, MANCC = @MANCC
	WHERE MASP = @MASP
 END
 GO
 -- INSERT SANPHAM TU SINH MA
CREATE PROC INSERT_SANPHAM_TUSINHMA
@TENSP NVARCHAR(40),
@SOLUONGTONKHO INT,
@NGAYSX DATE,
@HANSUDUNG DATE,
@DONGIA INT,
@MOTA NVARCHAR(100),
@MANSX VARCHAR(5),
@MANCC VARCHAR(5)
 AS
 BEGIN
 DECLARE @MA_NEXT VARCHAR(5)
SELECT @MA_NEXT = dbo.SANPHAM.MASP FROM dbo.SANPHAM
IF @MA_NEXT IS NULL
	SET @MA_NEXT = 0
ELSE
	SELECT @MA_NEXT = CONVERT(INT,SUBSTRING(MAX(dbo.SANPHAM.MASP),3,3)) FROM dbo.SANPHAM
	SET @MA_NEXT = 
CASE
	WHEN @MA_NEXT >= 0 AND @MA_NEXT <9 THEN 'SP00'+CONVERT(VARCHAR(1),@MA_NEXT+1)
	WHEN @MA_NEXT >=9 AND @MA_NEXT <99 THEN 'SP0'+CONVERT(VARCHAR(2),@MA_NEXT+1)
	WHEN @MA_NEXT >= 99 AND @MA_NEXT <999 THEN 'SP'+CONVERT(VARCHAR(3),@MA_NEXT+1)
END
 	INSERT INTO dbo.SANPHAM
 	        ( MASP ,
 	          TENSP ,
 	          SOLUONGTONKHO ,
 	          NGAYSX ,
 	          HANSUDUNG ,
 	          DONGIA ,
 	          MOTA ,
 	          MANSX ,
 	          MANCC
 	        )
 	VALUES  ( @MA_NEXT ,@TENSP ,@SOLUONGTONKHO ,@NGAYSX ,@HANSUDUNG ,@DONGIA ,@MOTA ,@MANSX ,@MANCC)
 END
 GO
-- TIM KIEM TUYET DOI SAN PHAM
CREATE PROC TIMKIEM_SANPHAM_TUYETDOI
@MASP VARCHAR(5),
@TENSP NVARCHAR(40),
@SOLUONGTONKHO INT,
@NGAYSX DATE,
@HANSUDUNG DATE,
@DONGIA INT,
@MOTA NVARCHAR(100),
@MANSX VARCHAR(5),
@MANCC VARCHAR(5)
AS
BEGIN
	SELECT *  
	FROM dbo.SANPHAM 
	WHERE MASP = @MASP AND TENSP = @TENSP AND SOLUONGTONKHO  = @SOLUONGTONKHO  AND NGAYSX  = @NGAYSX AND HANSUDUNG = @HANSUDUNG AND DONGIA  = @DONGIA AND MOTA = @MOTA AND MANSX  = @MANSX AND MANCC = @MANCC 
END
GO
-- TIM KIEM TUONG DOI
GO
CREATE PROC TIMKIEM_SANPHAM_TUONGDOI
	@MASP	VARCHAR(5),
	@TENSP	NVARCHAR(40),
	@SOLUONGTONKHO	INT,
	@NGAYSX		DATE,
	@HANSUDUNG		DATE,
	@DONGIA		INT,
	@MOTA		NVARCHAR(100),
	@MANSX		VARCHAR(5),
	@MANCC		VARCHAR(5)
AS
BEGIN
	SELECT *
	FROM dbo.SANPHAM  
	WHERE 
		MASP	LIKE '%'+ @MASP +'%' OR 
		TENSP	LIKE N'%'+ @TENSP +'%'OR 
		SOLUONGTONKHO =  @SOLUONGTONKHO OR 
		NGAYSX	LIKE  @NGAYSX OR
		HANSUDUNG LIKE @HANSUDUNG OR 
		DONGIA	=  @DONGIA OR 
		MOTA	LIKE N'%'+ @MOTA +'%'OR 
		MANSX	LIKE '%'+ @MANSX +'%'OR 
		MANCC	LIKE '%'+ @MANCC +'%'
END
GO

--=============================================== INSERT DATA ========================================================
GO
INSERT INTO dbo.BAN( MABAN, TRANGTHAI )VALUES  ( 'BAN01',0)
INSERT INTO dbo.BAN( MABAN, TRANGTHAI )VALUES  ( 'BAN02',0)
INSERT INTO dbo.BAN( MABAN, TRANGTHAI )VALUES  ( 'BAN03',0)
INSERT INTO dbo.BAN( MABAN, TRANGTHAI )VALUES  ( 'BAN04',0)
INSERT INTO dbo.BAN( MABAN, TRANGTHAI )VALUES  ( 'BAN05',0)
INSERT INTO dbo.BAN( MABAN, TRANGTHAI )VALUES  ( 'BAN06',0)
INSERT INTO dbo.BAN( MABAN, TRANGTHAI )VALUES  ( 'BAN07',0)
INSERT INTO dbo.BAN( MABAN, TRANGTHAI )VALUES  ( 'BAN08',0)
INSERT INTO dbo.BAN( MABAN, TRANGTHAI )VALUES  ( 'BAN09',0)
INSERT INTO dbo.BAN( MABAN, TRANGTHAI )VALUES  ( 'BAN10',0)
INSERT INTO dbo.BAN( MABAN, TRANGTHAI )VALUES  ( 'BAN11',0)
INSERT INTO dbo.BAN( MABAN, TRANGTHAI )VALUES  ( 'BAN12',0)
INSERT INTO dbo.BAN( MABAN, TRANGTHAI )VALUES  ( 'BAN13',0)
GO

INSERT INTO DBO.NHACUNGCAP(MANCC,TENNCC,DIENTHOAI) VALUES 
	('NCC01',N'Nhà Cung Cấp 01','0977389289'),
	('NCC02',N'Nhà Cung Cấp 02','0966669289'),
	('NCC03',N'Nhà Cung Cấp 03','0977334349'),
	('NCC04',N'Nhà Cung Cấp 04','0972323289'),
	('NCC05',N'Nhà Cung Cấp 05','0975454589'),
	('NCC06',N'Nhà Cung Cấp 06','0975445289'),
	('NCC07',N'Nhà Cung Cấp 07','0977354589')
GO
INSERT INTO DBO.NHASANXUAT(MANSX,TENNSX,QUOCGIA) 
	VALUES 
		('NSX01',N'Nhà Sản Xuất 01 ',N'VIỆT NAM'),
		('NSX02',N'Nhà Sản Xuất 02 ',N'VIỆT NAM'),
		('NSX03',N'Nhà Sản Xuất 03 ',N'TRUNG QUỐC'),
		('NSX04',N'Nhà Sản Xuất 04 ',N'TRUNG QUỐC'),
		('NSX05',N'Nhà Sản Xuất 05 ',N'VIỆT NAM'),
		('NSX06',N'Nhà Sản Xuất 06 ',N'VIỆT NAM'),
		('NSX07',N'Nhà Sản Xuất 07 ',N'VIỆT NAM'),
		('NSX08',N'Nhà Sản Xuất 08 ',N'TRUNG QUỐC'),
		('NSX09',N'Nhà Sản Xuất 09 ',N'VIỆT NAM'),
		('NSX10',N'Nhà Sản Xuất 10 ',N'VIỆT NAM'),
		('NSX11',N'Nhà Sản Xuất 11 ',N'TRUNG QUỐC'),
		('NSX12',N'Nhà Sản Xuất 12 ',N'VIỆT NAM')
GO
INSERT INTO DBO.SANPHAM(MASP,TENSP,SOLUONGTONKHO,NGAYSX,HANSUDUNG,DONGIA,MOTA,MANSX,MANCC)
VALUES
		('SP001',N'SẢN PHẨM 0001',100,'09/12/2017','03/08/2019',10000,N'SẢN PHẨM TỐT','NSX01','NCC02'),
		('SP002',N'SẢN PHẨM 0002',200,'04/11/2017','04/12/2019',10000,N'SẢN PHẨM TỐT','NSX11','NCC01'),
		('SP003',N'SẢN PHẨM 0003',300,'05/10/2017','05/10/2019',15000,N'SẢN PHẨM TỐT','NSX10','NCC03'),
		('SP004',N'SẢN PHẨM 0004',100,'06/09/2017','06/09/2019',10000,N'SẢN PHẨM TỐT','NSX09','NCC04'),
		('SP005',N'SẢN PHẨM 0005',300,'07/08/2017','08/08/2019',20000,N'SẢN PHẨM TỐT','NSX08','NCC05'),
		('SP006',N'SẢN PHẨM 0006',200,'08/07/2017','09/07/2019',10000,N'SẢN PHẨM TỐT','NSX07','NCC06'),
		('SP007',N'SẢN PHẨM 0007',100,'09/06/2017','10/05/2019',20000,N'SẢN PHẨM TỐT','NSX06','NCC05'),
		('SP008',N'SẢN PHẨM 0008',300,'10/05/2017','12/04/2019',20000,N'SẢN PHẨM TỐT','NSX05','NCC04'),
		('SP009',N'SẢN PHẨM 0009',200,'11/04/2017','11/03/2019',15000,N'SẢN PHẨM TỐT','NSX04','NCC03'),
		('SP010',N'SẢN PHẨM 00010',400,'09/03/2017','08/08/2019',10000,N'SẢN PHẨM TỐT','NSX03','NCC02'),
		('SP011',N'SẢN PHẨM 00011',200,'09/04/2017','08/04/2019',15000,N'SẢN PHẨM TỐT','NSX02','NCC01')
GO

INSERT INTO DBO.TAIKHOAN(USERNAME,PASSWORD,QUYENHAN)
VALUES
		('TK001','TAIKHOAN1',0),
		('TK002','TAIKHOAN2',0),
		('TK003','TAIKHOAN3',0),
		('TK004','TAIKHOAN4',0),
		('TK005','TAIKHOAN5',0)
GO
INSERT INTO DBO.NHANVIEN( USERNAME ,MANV ,HONV ,TENNV , NGAYSINH ,GIOITINH ,DIENTHOAI,CMND,NGAYVAOLAM )
VALUES
		('TK001','NV001',N'NGUYỄN QUỐC',N'ĐẠT','11/30/1996',1,'01643127775','205009090','03/03/2017'),
		('TK002','NV002',N'PHAN VĂN',N'HẢI','08/08/1995',1,'0977345490','187429653','03/03/2017'),
		('TK003','NV003',N'TRẦN XUÂN',N'CƯỜNG','04/01/1995',1,'01658542535','287429453','03/03/2017'),
		('TK004','NV004',N'PHAN THỊ',N'THANH','01/06/1995',0,'0977345491','187429654','03/03/2017'),
		('TK005','NV005',N'LÊ',N'HOÀNG','06/06/1997',0,'0988977889','123429653','03/03/2017')
GO
--==================================
CREATE PROCEDURE TIMKIEM_SANPHAM
    @MASP VARCHAR(5),
    @TENSP NVARCHAR(40),
    @DONGIA INT,
    @MANCC VARCHAR(5),
    @MANSX VARCHAR(5)
AS
BEGIN
	SELECT *
	FROM SANPHAM
	WHERE (@MASP IS NULL OR MASP = @MASP)
	AND (@TENSP IS NULL OR TENSP = @TENSP)
	AND (@DONGIA IS NULL OR DONGIA =@DONGIA)
	AND (@MANCC IS NULL OR MANCC = @MANCC)
	AND (@MANSX IS NULL OR MANSX = @MANSX)
END
GO
EXEC TIMKIEM_SANPHAM NULL,NULL,'10000',NULL,NULL
--===================================
GO
CREATE PROCEDURE TIMKIEM_SANPHAM2
    @MASP VARCHAR(5),
    @TENSP NVARCHAR(40),
    @DONGIA VARCHAR(10),
    @MANCC VARCHAR(5),
    @MANSX VARCHAR(5)
AS
BEGIN
	DECLARE @SQLQUERY NVARCHAR(4000)
	SELECT @SQLQUERY ='SELECT *
	FROM SANPHAM WHERE (1=1)'
	IF @MASP IS NOT NULL
		SELECT @SQLQUERY += ' AND (MASP = '''+@MASP+''')'
	IF @TENSP IS NOT NULL
		SELECT @SQLQUERY += ' AND (TENSP = '''+@TENSP+''')'
	IF @DONGIA IS NOT NULL
		SELECT @SQLQUERY += ' AND (DONGIA = '''+@DONGIA+''')'
	IF @MANCC IS NOT NULL
		SELECT @SQLQUERY += ' AND (MANCC = '''+@MANCC+''')'
	IF @MANSX IS NOT NULL
		SELECT @SQLQUERY += ' AND (MANSX = '''+@MANSX+''')'
	
	EXEC SP_EXECUTESQL @SQLQUERY
END
GO

DROP PROC dbo.TIMKIEM_SANPHAM2
EXEC TIMKIEM_SANPHAM2 'SP001',NULL,NULL,NULL,NULL
--==========================================


CREATE PROCEDURE TIMKIEM_SANPHAM3
    @MASP VARCHAR(5),
    @TENSP NVARCHAR(40),
    @DONGIA VARCHAR(10),
    @MANCC VARCHAR(5),
    @MANSX VARCHAR(5)
AS
BEGIN
	DECLARE @SQLQUERY NVARCHAR(4000)
	SELECT @SQLQUERY ='SELECT *
	FROM SANPHAM WHERE (1=1)'
	IF @MASP IS NOT NULL
		SELECT @SQLQUERY += ' AND (MASP LIKE ''%' +@MASP+'%'')'
	IF @TENSP IS NOT NULL
		SELECT @SQLQUERY += ' AND (TENSP LIKE ''%' +@TENSP+'%'')'
	IF @DONGIA IS NOT NULL
		SELECT @SQLQUERY += ' AND (DONGIA LIKE ''%' +@DONGIA+'%'')'
	IF @MANCC IS NOT NULL
		SELECT @SQLQUERY += ' AND (MANCC LIKE ''%' +@MANCC+'%'')'
	IF @MANSX IS NOT NULL
		SELECT @SQLQUERY += ' AND (MANSX LIKE ''%' +@MANSX+'%'')'
	
	EXEC SP_EXECUTESQL @SQLQUERY
END
GO

EXEC TIMKIEM_SANPHAM3 NULL,'S',NULL,NULL,NULL